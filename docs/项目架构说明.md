# ğŸ—ï¸ é¡¹ç›®æ¶æ„é‡æ„è¯´æ˜

## ğŸ“ æ–°çš„é¡¹ç›®ç»“æ„

```
WindowScope/
â”œâ”€â”€ src/                           # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                    # é…ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ settings.py            # é›†ä¸­é…ç½®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ capture_engine.py     # æ•è·å¼•æ“ï¼ˆä¿¡å·é©±åŠ¨ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                        # ç”¨æˆ·ç•Œé¢å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main_window.py        # ä¸»çª—å£
â”‚   â”‚   â”œâ”€â”€ capture_window.py     # ç›‘è§†çª—å£
â”‚   â”‚   â””â”€â”€ region_selector.py    # åŒºåŸŸé€‰æ‹©å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ logger.py             # æ—¥å¿—ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ win32_helper.py       # Windows API å°è£…
â”‚   â”‚
â”‚   â””â”€â”€ main.py                    # åº”ç”¨ç¨‹åºå…¥å£
â”‚
â”œâ”€â”€ window_capture_pyqt6.py        # åŸç‰ˆæœ¬ï¼ˆä½œä¸ºå¤‡ä»½ï¼‰
â”œâ”€â”€ requirements.txt               # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
```

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. SOLID åŸåˆ™

#### S - å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility)
- **CaptureEngine**: åªè´Ÿè´£æ•è·é€»è¾‘
- **RegionSelector**: åªè´Ÿè´£åŒºåŸŸé€‰æ‹© UI
- **Logger**: åªè´Ÿè´£æ—¥å¿—è®°å½•
- **ScreenCapture**: åªè´Ÿè´£å±å¹•æ•è·æ–¹æ³•

#### O - å¼€é—­åŸåˆ™ (Open/Closed)
- ä½¿ç”¨é…ç½®æ–‡ä»¶è€Œéç¡¬ç¼–ç 
- é€šè¿‡ç»§æ‰¿å’Œæ¥å£æ‰©å±•åŠŸèƒ½
- æ–°å¢æ•è·æ–¹æ³•ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 

#### L - é‡Œæ°æ›¿æ¢åŸåˆ™ (Liskov Substitution)
- æ‰€æœ‰ QObject å­ç±»å¯äº’ç›¸æ›¿æ¢
- æ•è·æ–¹æ³•éµå¾ªç»Ÿä¸€æ¥å£

#### I - æ¥å£éš”ç¦»åŸåˆ™ (Interface Segregation)
- ä½¿ç”¨ PyQt6 ä¿¡å·æœºåˆ¶å®ç°æ¾è€¦åˆ
- å„æ¨¡å—åªä¾èµ–éœ€è¦çš„æ¥å£

#### D - ä¾èµ–å€’ç½®åŸåˆ™ (Dependency Inversion)
- é«˜å±‚æ¨¡å—ï¼ˆUIï¼‰ä¸ç›´æ¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆæ•è·ï¼‰
- é€šè¿‡ä¿¡å·/æ§½æœºåˆ¶å®ç°è§£è€¦

### 2. å…³æ³¨ç‚¹åˆ†ç¦»

```
UI å±‚ (ui/)
    â†“ ä¿¡å·/æ§½
æ ¸å¿ƒå±‚ (core/)
    â†“ è°ƒç”¨
å·¥å…·å±‚ (utils/)
```

### 3. æ¨¡å—åŒ–è®¾è®¡

æ¯ä¸ªæ¨¡å—éƒ½æ˜¯ç‹¬ç«‹çš„ã€å¯æµ‹è¯•çš„å•å…ƒï¼š

```python
# é…ç½®æ¨¡å— - æ•°æ®ç±»
@dataclass
class AppSettings:
    ...

# æ ¸å¿ƒæ¨¡å— - ä¸šåŠ¡é€»è¾‘
class CaptureEngine(QObject):
    frame_captured = pyqtSignal(QImage)
    ...

# UI æ¨¡å— - ç•Œé¢å±•ç¤º
class CaptureWindow(QDialog):
    def __init__(self, engine: CaptureEngine):
        engine.frame_captured.connect(self.on_frame)
    ...
```

## ğŸ“‹ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. é…ç½®æ¨¡å— (`config/settings.py`)

**èŒè´£**: é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®é¡¹

**ä¼˜ç‚¹**:
- âœ… é¿å…é­”æ³•æ•°å­—
- âœ… æ˜“äºç»´æŠ¤å’Œä¿®æ”¹
- âœ… ç±»å‹å®‰å…¨ï¼ˆä½¿ç”¨ dataclassï¼‰

```python
@dataclass
class CaptureSettings:
    default_fps: int = 30
    min_fps: int = 1
    max_fps: int = 60
    ...

settings = AppSettings()  # å…¨å±€å•ä¾‹
```

### 2. æ—¥å¿—æ¨¡å— (`utils/logger.py`)

**èŒè´£**: ç»Ÿä¸€çš„æ—¥å¿—è®°å½•

**ä¼˜ç‚¹**:
- âœ… å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€ä¸€è‡´
- âœ… æ”¯æŒå¤šç§è¾“å‡ºï¼ˆæ§åˆ¶å°ã€æ–‡ä»¶ï¼‰
- âœ… æ ‡å‡†çš„æ—¥å¿—çº§åˆ«ï¼ˆDEBUG, INFO, WARNING, ERRORï¼‰
- âœ… æ˜“äºæ‰©å±•ï¼ˆå¦‚å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼‰

```python
logger = Logger()  # å…¨å±€å•ä¾‹
logger.info("åº”ç”¨å¯åŠ¨")
logger.error("æ•è·å¤±è´¥")
```

### 3. Windows å·¥å…·æ¨¡å— (`utils/win32_helper.py`)

**èŒè´£**: å°è£… Windows API è°ƒç”¨

**ä¼˜ç‚¹**:
- âœ… éš”ç¦»åº•å±‚ API ç»†èŠ‚
- âœ… æä¾›é«˜å±‚æ¬¡çš„æŠ½è±¡
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- âœ… æ˜“äºæµ‹è¯•ï¼ˆå¯ä»¥ mockï¼‰

```python
class WindowManager:
    @staticmethod
    def enum_windows() -> List[Tuple[int, str]]:
        ...

class ScreenCapture:
    @staticmethod
    def capture_window(hwnd, width, height):
        ...
```

### 4. æ•è·å¼•æ“ (`core/capture_engine.py`)

**èŒè´£**: æ ¸å¿ƒæ•è·é€»è¾‘ï¼Œä½¿ç”¨ä¿¡å·é©±åŠ¨

**ä¼˜ç‚¹**:
- âœ… ä¸ UI å®Œå…¨è§£è€¦
- âœ… å¯ç‹¬ç«‹æµ‹è¯•
- âœ… äº‹ä»¶é©±åŠ¨æ¶æ„
- âœ… æ˜“äºæ‰©å±•åŠŸèƒ½

```python
class CaptureEngine(QObject):
    # ä¿¡å·å®šä¹‰
    frame_captured = pyqtSignal(QImage)
    capture_failed = pyqtSignal(str)
    fps_updated = pyqtSignal(float)
    
    def start(self): ...
    def pause(self): ...
    def set_fps(self, fps): ...
```

### 5. UI ç»„ä»¶ (`ui/`)

**èŒè´£**: ç”¨æˆ·ç•Œé¢å±•ç¤ºå’Œäº¤äº’

**ä¼˜ç‚¹**:
- âœ… åªè´Ÿè´£æ˜¾ç¤ºå’Œç”¨æˆ·äº¤äº’
- âœ… ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- âœ… é€šè¿‡ä¿¡å·ä¸æ ¸å¿ƒå±‚é€šä¿¡
- âœ… æ˜“äºé‡æ–°è®¾è®¡ UI

## ğŸ”„ æ•°æ®æµ

### æ•è·æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"å¯åŠ¨ç›‘è§†"
    â†“
MainWindow.start_capture()
    â†“
åˆ›å»º CaptureEngine
    â†“
åˆ›å»º CaptureWindow
    â†“
engine.frame_captured â†’ window.on_frame()
    â†“
æ˜¾ç¤ºå›¾åƒ
```

### ä¿¡å·æµ

```
CaptureEngine (æ ¸å¿ƒå±‚)
    â”œâ”€ frame_captured â†’ CaptureWindow.on_frame()
    â”œâ”€ fps_updated â†’ CaptureWindow.update_fps()
    â”œâ”€ method_changed â†’ CaptureWindow.update_method()
    â””â”€ capture_failed â†’ CaptureWindow.on_error()
```

## ğŸ¨ æ¶æ„æ¨¡å¼

### MVC å˜ä½“ (Model-View-Controller)

```
Model (core/)
  - CaptureEngine
  - ä¸šåŠ¡é€»è¾‘

View (ui/)
  - MainWindow
  - CaptureWindow
  - RegionSelector
  - UI å±•ç¤º

Controller (éšå¼)
  - Qt ä¿¡å·/æ§½æœºåˆ¶
  - äº‹ä»¶å¤„ç†
```

### è§‚å¯Ÿè€…æ¨¡å¼

ä½¿ç”¨ PyQt6 çš„ä¿¡å·/æ§½æœºåˆ¶å®ç°ï¼š

```python
# å‘å¸ƒè€…
class CaptureEngine(QObject):
    frame_captured = pyqtSignal(QImage)

# è®¢é˜…è€…
class CaptureWindow(QDialog):
    def __init__(self, engine):
        engine.frame_captured.connect(self.on_frame)
```

### å•ä¾‹æ¨¡å¼

```python
# Logger å•ä¾‹
logger = Logger()

# Settings å•ä¾‹
settings = AppSettings()
```

## ğŸ“ˆ ç›¸æ¯”åŸæ¶æ„çš„ä¼˜åŠ¿

### åŸæ¶æ„ (å•æ–‡ä»¶)

```
window_capture_pyqt6.py (981 è¡Œ)
    â”œâ”€ å…¨å±€å‡½æ•°
    â”œâ”€ æ•°æ®ç»“æ„å®šä¹‰
    â”œâ”€ UI ç±»
    â””â”€ ä¸šåŠ¡é€»è¾‘
```

**é—®é¢˜**:
- âŒ ä»£ç è€¦åˆåº¦é«˜
- âŒ éš¾ä»¥æµ‹è¯•
- âŒ éš¾ä»¥ç»´æŠ¤
- âŒ é‡ç”¨æ€§å·®

### æ–°æ¶æ„ (æ¨¡å—åŒ–)

```
src/
â”œâ”€ config/    (é…ç½®)
â”œâ”€ core/      (æ ¸å¿ƒé€»è¾‘)
â”œâ”€ ui/        (ç•Œé¢)
â””â”€ utils/     (å·¥å…·)
```

**ä¼˜åŠ¿**:
- âœ… å…³æ³¨ç‚¹åˆ†ç¦»
- âœ… æ˜“äºæµ‹è¯•
- âœ… æ˜“äºç»´æŠ¤
- âœ… é«˜åº¦å¯é‡ç”¨
- âœ… æ˜“äºæ‰©å±•

## ğŸ§ª å¯æµ‹è¯•æ€§

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```python
# æµ‹è¯•æ•è·å¼•æ“
def test_capture_engine():
    engine = CaptureEngine(hwnd=12345, region=(0,0,100,100))
    
    # æµ‹è¯•ä¿¡å·
    with qtbot.waitSignal(engine.frame_captured):
        engine.start()

# æµ‹è¯•çª—å£ç®¡ç†å™¨
def test_enum_windows():
    windows = WindowManager.enum_windows()
    assert len(windows) > 0
```

### é›†æˆæµ‹è¯•

```python
def test_full_workflow():
    app = QApplication()
    main_window = MainWindow()
    # æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œ
    ...
```

## ğŸ”§ æ‰©å±•æ€§

### æ·»åŠ æ–°çš„æ•è·æ–¹æ³•

åªéœ€åœ¨ `ScreenCapture` ç±»ä¸­æ·»åŠ ï¼š

```python
class ScreenCapture:
    @staticmethod
    def capture_window_new_method(hwnd, width, height):
        ...
    
    @classmethod
    def capture_window(cls, hwnd, width, height):
        # å°è¯•æ–°æ–¹æ³•
        img, ok = cls.capture_window_new_method(...)
        if ok:
            return img, "new_method"
        ...
```

### æ·»åŠ æ–°çš„ UI åŠŸèƒ½

åˆ›å»ºæ–°çš„ UI ç»„ä»¶ï¼š

```python
# src/ui/settings_dialog.py
class SettingsDialog(QDialog):
    ...
```

### æ·»åŠ é…ç½®é¡¹

åœ¨ `settings.py` ä¸­æ·»åŠ ï¼š

```python
@dataclass
class NewSettings:
    option1: bool = True
    ...

@dataclass
class AppSettings:
    new: NewSettings = NewSettings()
```

## ğŸ“š æ–‡ä»¶èŒè´£è¯´æ˜

| æ–‡ä»¶ | èŒè´£ | è¡Œæ•° | ä¾èµ– |
|------|------|------|------|
| `config/settings.py` | é…ç½®ç®¡ç† | ~60 | æ ‡å‡†åº“ |
| `utils/logger.py` | æ—¥å¿—ç®¡ç† | ~80 | logging |
| `utils/win32_helper.py` | Windows API | ~200 | win32gui, PyQt6 |
| `core/capture_engine.py` | æ•è·å¼•æ“ | ~150 | utils, config |
| `ui/region_selector.py` | åŒºåŸŸé€‰æ‹©å™¨ | ~250 | utils, config |
| `ui/capture_window.py` | ç›‘è§†çª—å£ | ~200 | core, utils |
| `ui/main_window.py` | ä¸»çª—å£ | ~300 | ui, core, utils |
| `main.py` | ç¨‹åºå…¥å£ | ~50 | ui, config |

**æ€»è®¡**: ~1,290 è¡Œï¼ˆæ¯”åŸæ¥çš„ 981 è¡Œç•¥å¤šï¼Œä½†æ›´æ˜“ç»´æŠ¤ï¼‰

## ğŸ“ å­¦ä¹ è¦ç‚¹

### 1. ä¾èµ–æ³¨å…¥

```python
# ä¸å¥½çš„åšæ³•ï¼ˆç¡¬ç¼–ç ä¾èµ–ï¼‰
class CaptureWindow:
    def __init__(self):
        self.engine = CaptureEngine()  # ç¡¬ç¼–ç 

# å¥½çš„åšæ³•ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
class CaptureWindow:
    def __init__(self, engine: CaptureEngine):
        self.engine = engine  # æ³¨å…¥ä¾èµ–
```

### 2. ä¿¡å·é©±åŠ¨

```python
# ä¸å¥½çš„åšæ³•ï¼ˆç›´æ¥è°ƒç”¨ï¼‰
class CaptureEngine:
    def capture(self):
        img = ...
        self.window.display(img)  # ç›´æ¥è°ƒç”¨

# å¥½çš„åšæ³•ï¼ˆä¿¡å·é©±åŠ¨ï¼‰
class CaptureEngine(QObject):
    frame_captured = pyqtSignal(QImage)
    
    def capture(self):
        img = ...
        self.frame_captured.emit(img)  # å‘å°„ä¿¡å·
```

### 3. é…ç½®ç®¡ç†

```python
# ä¸å¥½çš„åšæ³•ï¼ˆé­”æ³•æ•°å­—ï¼‰
if fps < 1 or fps > 60:
    ...

# å¥½çš„åšæ³•ï¼ˆä½¿ç”¨é…ç½®ï¼‰
if fps < settings.capture.min_fps or fps > settings.capture.max_fps:
    ...
```

## ğŸš€ è¿ç§»æŒ‡å—

ä»æ—§ç‰ˆæœ¬è¿ç§»åˆ°æ–°æ¶æ„ï¼š

1. **å®‰è£…ä¾èµ–** (ç›¸åŒ)
   ```bash
   pip install pywin32 PyQt6
   ```

2. **è¿è¡Œæ–°ç‰ˆæœ¬**
   ```bash
   python src/main.py
   ```

3. **ä¿ç•™æ—§ç‰ˆæœ¬**
   ```bash
   # æ—§ç‰ˆæœ¬ä»ç„¶å¯ç”¨
   python window_capture_pyqt6.py
   ```

## ğŸ“– æ€»ç»“

æ–°æ¶æ„çš„æ ¸å¿ƒæ€æƒ³ï¼š

1. **æ¨¡å—åŒ–** - æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€
2. **è§£è€¦** - é€šè¿‡ä¿¡å·/é…ç½®é™ä½è€¦åˆ
3. **å¯æµ‹è¯•** - ç‹¬ç«‹çš„æ¨¡å—æ˜“äºæµ‹è¯•
4. **å¯æ‰©å±•** - éµå¾ªå¼€é—­åŸåˆ™
5. **å¯ç»´æŠ¤** - æ¸…æ™°çš„ç»“æ„æ˜“äºç»´æŠ¤

è¿™æ˜¯ä¸€ä¸ªç¬¦åˆç°ä»£è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µçš„æ¶æ„ï¼ğŸ‰

