# WindowScope - 打包为 EXE 说明

## 方法一：使用自动打包脚本（推荐）

### 步骤：

1. **直接双击运行 `build_exe.bat`**
   - 脚本会自动检测并安装 PyInstaller（如果未安装）
   - 自动清理旧文件
   - 自动打包程序
   - 完成后可选择打开输出文件夹

2. **查看结果**
   - 打包完成后，在 `dist` 文件夹中找到 `WindowScope.exe`
   - 这是一个独立的可执行文件，可以在任何 Windows 电脑上运行（无需安装 Python）

---

## 方法二：手动打包

### 前置要求：

```bash
pip install pyinstaller
```

### 打包步骤：

#### 1. 清理旧文件（可选）
```bash
rd /s /q build
rd /s /q dist
```

#### 2. 使用 spec 文件打包
```bash
pyinstaller build_exe.spec --clean
```

#### 3. 查看结果
生成的 exe 文件位于：`dist\WindowScope.exe`

---

## 打包配置说明

### 当前配置（`build_exe.spec`）：

- **打包模式**：单文件模式（所有依赖打包到一个 exe 中）
- **控制台窗口**：关闭（`console=False`）
- **UPX 压缩**：开启（减小文件大小）
- **包含的依赖**：
  - PyQt6（GUI 框架）
  - pywin32（Windows API）
  - 所有源代码模块

### 自定义配置：

#### 添加应用图标：
1. 准备一个 `.ico` 文件（推荐 256x256 像素）
2. 将图标文件放在项目根目录
3. 修改 `build_exe.spec` 中的 `icon` 参数：
   ```python
   icon='your_icon.ico'
   ```

#### 显示控制台窗口（用于调试）：
修改 `build_exe.spec` 中的 `console` 参数：
```python
console=True  # 显示控制台，方便查看日志
```

#### 分离目录模式（而非单文件）：
如果想要更快的启动速度，可以使用目录模式：
```bash
pyinstaller build_exe.spec --clean --onedir
```
这会生成一个文件夹，里面包含 exe 和所有 dll 文件。

---

## 常见问题

### Q1: 打包后运行报错 "ImportError: attempted relative import with no known parent package"？
**A:** 这是相对导入的问题，已经解决！

**原因**：
- `src/main.py` 使用了相对导入（`from .config import settings`）
- PyInstaller 打包时无法正确处理相对导入

**解决方案**：
- 已创建 `run.py` 作为新的入口文件，使用绝对导入
- `build_exe.spec` 已更新为使用 `run.py` 作为入口点
- 重新打包后可以正常运行

详细说明请查看：**`相对导入问题修复说明.md`**

### Q2: 打包后 exe 文件很大（100MB+）？
**A:** 这是正常的，因为包含了：
- Python 解释器
- PyQt6 库（很大）
- pywin32 库
- 所有依赖

**解决方案**：
- 已启用 UPX 压缩
- 可以使用 7-Zip 等工具再次压缩
- 或者使用 `--onedir` 模式，将文件分散到文件夹中

### Q3: 打包后运行出错？
**A:** 检查以下几点：
1. 确保在打包前程序能正常运行
2. 检查是否缺少隐藏导入（查看错误日志）
3. 如果缺少模块，在 `build_exe.spec` 的 `hiddenimports` 中添加

### Q4: 杀毒软件报毒？
**A:** 这是 PyInstaller 的常见问题（误报）：
- 将 exe 添加到杀毒软件白名单
- 或者购买代码签名证书对 exe 进行签名

### Q5: 想要更小的文件？
**A:** 尝试以下方法：
1. 使用虚拟环境打包（只包含必要的包）：
   ```bash
   python -m venv venv_build
   venv_build\Scripts\activate
   pip install -r requirements.txt
   pip install pyinstaller
   pyinstaller build_exe.spec --clean
   ```
2. 排除不必要的模块
3. 使用 UPX 压缩（已启用）

### Q6: 启动速度慢？
**A:** 单文件模式的启动稍慢，因为需要解压：
- 使用 `--onedir` 模式可以加快启动
- 或者接受 2-3 秒的启动时间

---

## 打包后的分发

### 分发单个 exe：
- 直接将 `dist\EVE窗口监视器.exe` 发给用户
- 用户可以直接运行，无需安装任何东西

### 制作安装包（可选）：
可以使用以下工具制作专业的安装程序：
- **Inno Setup**（免费，推荐）
- **NSIS**（免费）
- **WiX Toolset**（免费）
- **Advanced Installer**（付费）

---

## 高级选项

### 添加版本信息：
1. 创建 `version.txt` 文件（需要额外配置）
2. 在 spec 文件中添加 `version='version.txt'`

### 多语言支持：
如果需要打包多语言资源文件，在 `datas` 中添加：
```python
datas=[('resources', 'resources')],
```

### 调试打包问题：
```bash
pyinstaller build_exe.spec --clean --debug all
```

---

## 总结

最简单的方法就是：
1. **双击 `build_exe.bat`**
2. **等待完成**
3. **在 `dist` 文件夹中获取 exe 文件**

就这么简单！🎉

